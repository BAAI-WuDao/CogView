(this.webpackJsonpcogview=this.webpackJsonpcogview||[]).push([[0],{140:function(e,t,s){},143:function(e,t,s){},144:function(e,t,s){},145:function(e,t,s){},186:function(e,t,s){"use strict";s.r(t);var a=s(5),n=s(0),i=s.n(n),r=s(24),c=s.n(r),o=(s(140),s(96)),l=s(110),h=s(111),u=s(132),d=s(129),g=(s(141),s(142),s(143),s(144),s(145),s(130)),m=s(192),b=s(128),p=s(193),j=s(194),_=s(191),y=s(190),f=s(91),v=s.n(f),k=s(195),x=s(196),O=s(197),w=s(198),z=s(199),T=s(49),S=s(133),N=s(200),q=s(201),C=s(92),I=s.n(C),H=s(46),F=s.n(H),G=[{original:"/get-image/3ce89ac028c09b64/1616143211249/1.jpg",description:"\u8001\u864e\u8e22\u8db3\u7403"},{original:"/get-image/5a55d16995103768/1616141359829/0.jpg",description:"\u732b\u732a"},{original:"/get-image/7602ae509c1eb89c/1616125734465/0.jpg",description:"\u76ae\u5361\u4e18\u53e3\u7ea2"},{original:"/get-image/85adf33bcb311930/1616081204688/9.jpg",description:"\u4e00\u4e2a\u5fc3\u9178\u7684\u535a\u58eb\u751f"},{original:"/get-image/c74715b9c09200c7/1616058920240/1.jpg",description:"\u9a91\u5728\u72d7\u4e0a\u7684\u4eba\u3002"},{original:"/get-image/750c997a71df19c8/1616059211648/0.jpg",description:"\u9a91\u5728\u6811\u4e0a\u7684\u4eba\u3002"},{original:"/get-image/4420193de4b0a18b/1616066682360/8.jpg",description:"\u4e00\u53ea\u6234\u58a8\u955c\u7684\u732b\u8db4\u5728\u684c\u5b50\u4e0a\u3002"},{original:"/get-image/43bd1e21199290a4/1616070424178/0.jpg",description:"\u4e00\u6761\u5c0f\u6eaa\u5728\u5c71\u6da7\u6d41\u6dcc"}],P=s(112),D=s.n(P),L={title:{zh:"\u6839\u636e\u6587\u5b57\u63cf\u8ff0\u751f\u6210\u56fe\u7247\u7684\u4eba\u5de5\u667a\u80fd",en:"Generating Images from Text Descriptions"},name_placeholder:{zh:"\u8bf7\u8f93\u5165\u60a8\u7684\u540d\u5b57\u6216\u6635\u79f0",en:"Enter you username"},name_prompt:{zh:"\u60a8\u7684\u6635\u79f0",en:"Name"},input_placeholder:{zh:"\u8bf7\u8f93\u5165\u60a8\u60f3\u8981\u751f\u6210\u7684\u56fe\u7247\u63cf\u8ff0",en:"Enter the text description for your desired image"},input_prompt:{zh:"\u56fe\u7247\u63cf\u8ff0",en:"Image Description"},warning_text:{zh:"CogView\u751f\u6210\u6a21\u578b\u4ec5\u652f\u6301\u7b80\u4f53\u4e2d\u6587\u8f93\u5165\u3002",en:"The CogView generation model only supports simplified Chinese input. You can use the translation button in the input box to translate the input text into Chinese."},regenerate:{zh:"\u91cd\u65b0\u751f\u6210",en:"Regenerate"},generate:{zh:"\u751f\u6210",en:"Generate"},show_history:{zh:"\u67e5\u770b\u5386\u53f2",en:"Show History"},queue_list:{zh:"\u6392\u961f\u5217\u8868\uff08\u5f53\u524d\u6570\u91cf\uff1a%size\uff09",en:"Queue (Current waiting: %size)"},queue_time:{zh:" / \u9884\u8ba1\u6392\u961f\u65f6\u95f4\uff1a%size min",en:" / Estimate waiting time: %size min"},author_prompt:{zh:"\u4f5c\u8005\uff1a",en:"Author: "},create_time_prompt:{zh:"\u521b\u5efa\u65f6\u95f4\uff1a",en:"Create Time: "},generate_time_prompt:{zh:"\u751f\u6210\u65f6\u95f4\uff1a",en:"Generate Time: "},history_records:{zh:"\u5386\u53f2\u8bb0\u5f55",en:"History Records"},task_not_found:{zh:"\u672a\u627e\u5230\u751f\u6210\u4efb\u52a1",en:"Task Not Found"},plz_regenerate:{zh:"\u8bf7\u91cd\u65b0\u751f\u6210",en:"Please Regenerate"},generate_fail:{zh:"\u751f\u6210\u5931\u8d25",en:"Generation Failed"},plz_regenerate_or_other:{zh:"\u8bf7\u91cd\u65b0\u751f\u6210\uff0c\u6216\u5c1d\u8bd5\u5176\u4ed6\u6587\u672c\u8fdb\u884c\u751f\u6210",en:"Please regenerate or try other inputs"},submitted_and_queue:{zh:"\u5df2\u63d0\u4ea4\uff0c\u6b63\u5728\u6392\u961f\u4e2d",en:"Submitted. Task waiting in queue now."},generating:{zh:"\u6b63\u5728\u751f\u6210\u4e2d",en:"Generating"},generate_and_wait:{zh:"\u751f\u6210\u4e00\u822c\u9700\u8981\u51e0\u5206\u949f\u65f6\u95f4\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85\u7ed3\u679c",en:"Generation usually takes several minutes. Please wait for a while."},input_name_not_empty:{zh:"\u8f93\u5165\u7684\u6635\u79f0\u4e0d\u80fd\u4e3a\u7a7a",en:"Your name must not be empty."},input_length_not_valid:{zh:"\u8f93\u5165\u7684\u56fe\u7247\u63cf\u8ff0\u957f\u5ea6\u57282\uff5e30\u4e4b\u95f4\uff0c\u5f53\u524d\u957f\u5ea6\uff1a%size",en:"The number of characters in input image description must be between 2 and 30. Current length: %size"},submit_too_fast:{zh:"\u63d0\u4ea4\u65f6\u95f4\u8fc7\u5feb\uff0c\u8bf7\u7a0d\u7b49\u7247\u523b\u3002",en:"Submission too fast. Please wait for a while."},service_err:{zh:"\u670d\u52a1\u5f02\u5e38\uff1a%err",en:"Service error: %err"},translation_succeed:{zh:"\u7ffb\u8bd1\u6210\u529f\u3002",en:"Translation succeed. "},translation_failed:{zh:"\u7ffb\u8bd1\u5931\u8d25\u3002",en:"Translation failed. "},load_history_records:{zh:"\u52a0\u8f7d%size\u6761\u5386\u53f2\u8bb0\u5f55\u3002",en:"Load %size history records."},generation_succeed_all_img:{zh:"\u751f\u6210\u6210\u529f\uff01\u603b\u5171\u751f\u6210%size\u5f20\u56fe\u7247\u3002",en:"Generation succeed. %size images generated in total."},request_failed:{zh:"\u8bf7\u6c42\u5931\u8d25\uff1a",en:"Request failed:"},switch_lang:{zh:"English Display",en:"\u4e2d\u6587\u754c\u9762"},github:{zh:"Github",en:"Github"}},E=s(113),B=s.n(E),M="https://wudao.aminer.cn/api/cogview/",R="cogview.v1.username",W=function(e){Object(u.a)(s,e);var t=Object(d.a)(s);function s(e){var a;return Object(l.a)(this,s),(a=t.call(this,e)).detectTrans=I.a.debounce((function(){console.log("length",a.state.query.trim().length),a.state.query.trim().length<5&&a.setState({enableTrans:!1});var e=D()(a.state.query+" ");a.setState({enableTrans:"cmn"!==e&&"und"!==e})}),500),a.state={model:"login",username:localStorage.getItem(R)||"",query:"\u4e00\u53ea\u6234\u58a8\u955c\u7684\u732b\u8db4\u5728\u684c\u5b50\u4e0a\u3002",loading:!1,task:void 0,displayHistory:!1,historyTasks:[],waitingTasks:[],waitingTime:0,enableTrans:!1,lang:"en"===(navigator.language||navigator.userLanguage)?"en":"zh"},a.poll_process=void 0,a.poll_interval=5,a.last_submit_time=0,a.refreshWaitingTasks(),a.refresh_process=setInterval((function(){a.refreshWaitingTasks(),a.refreshHistoryTasks()}),5e3),a}return Object(h.a)(s,[{key:"refreshWaitingTasks",value:function(){var e=this;F.a.get("".concat(M,"/waiting")).then((function(t){e.setState({waitingTasks:t.data.tasks,waitingTime:Math.ceil(t.data.estimate_time/60)})})).catch((function(t){console.log(e.t("service_err",{err:t}))}))}},{key:"refreshHistoryTasks",value:function(){var e=this;F.a.get("".concat(M,"/history")).then((function(t){e.setState({historyTasks:t.data.tasks})})).catch((function(t){console.log(e.t("service_err",{err:t}))}))}},{key:"t",value:function(e,t){var s=L[e][this.state.lang];return t&&Object.keys(t).forEach((function(e){s=s.replace("%"+e,t[e])})),s}},{key:"datestr",value:function(e){return B()(new Date(e),"yyyy/mm/dd h:MM:ss")}},{key:"translate",value:function(){var e=this;this.setState({loading:!0}),F.a.post("".concat(M,"/translate"),{query:this.state.query}).then((function(t){var s=t.data;s.status?(e.setState({loading:!1,enableTrans:!1,query:s.text}),g.b.success(e.t("translation_succeed"))):(e.setState({loading:!1,enableTrans:!1}),g.b.warning(e.t("translation_failed")+s.message))})).catch((function(t){e.setState({loading:!1,enableTrans:!1}),g.b.error(e.t("service_err",{err:t}))}))}},{key:"renderLogin",value:function(){var e=this,t=this.state.query.trim().length<2||0===this.state.username.trim().length||this.state.query.trim().length>30;return Object(a.jsxs)("div",{className:"login",children:[Object(a.jsx)("div",{className:"logo",style:{backgroundImage:"url(".concat("/CogView/logo.png",")")}}),Object(a.jsx)("div",{id:"logo-description",children:this.t("title")}),Object(a.jsx)(m.a.Group,{className:"login-input",children:Object(a.jsx)(m.a,{size:"large",placeholder:this.t("name_placeholder"),prefix:Object(a.jsxs)("div",{children:[Object(a.jsx)(k.a,{className:"site-form-item-icon"}),Object(a.jsx)("span",{className:"input-inner-header",children:this.t("name_prompt")})]}),suffix:Object(a.jsx)(x.a,{className:"btn",style:{color:"white"}}),value:this.state.username,onChange:function(t){return e.setState({username:t.target.value})}})}),Object(a.jsx)(m.a.Group,{className:"login-input",children:Object(a.jsx)(m.a,{size:"large",placeholder:this.t("input_placeholder"),prefix:Object(a.jsxs)("div",{children:[Object(a.jsx)(O.a,{className:"site-form-item-icon"}),Object(a.jsx)("span",{className:"input-inner-header",children:this.t("input_prompt")})]}),suffix:Object(a.jsxs)("div",{children:[this.state.enableTrans&&Object(a.jsx)(w.a,{className:"enter-btn",style:{color:this.state.loading?"lightgray":"black"},onClick:function(){return e.translate()}}),Object(a.jsx)(x.a,{className:"enter-btn",style:{color:t?"lightgray":"black"},onClick:function(){return e.generate()}})]}),value:this.state.query,onChange:function(t){e.detectTrans(),e.setState({query:t.target.value})},onPressEnter:function(){return e.generate()}})}),Object(a.jsxs)("div",{className:"login-btns",children:[Object(a.jsx)("div",{className:"prompt",children:Object(a.jsx)("p",{children:this.t("warning_text")})}),void 0!==this.state.task&&"Succeed"===this.state.task.status&&this.state.task.query===this.state.query.trim()?Object(a.jsx)(b.a,{className:"wbtn login-btn",onClick:function(){return e.generate(!0)},disabled:t,children:this.t("regenerate")}):Object(a.jsx)(b.a,{className:"wbtn login-btn",onClick:function(){return e.generate()},disabled:t,children:this.t("generate")}),Object(a.jsx)(b.a,{className:"wbtn history-display-btn",onClick:function(){return e.showHistory()},children:this.t("show_history")}),Object(a.jsx)(b.a,{className:"wbtn lang-btn",onClick:function(){return e.setState({lang:"zh"===e.state.lang?"en":"zh"})},children:this.t("switch_lang")}),Object(a.jsx)(b.a,{className:"wbtn github-btn",onClick:function(){return window.location.href="https://github.com/THUDM/CogView"},children:this.t("github")})]})]})}},{key:"updateHistory",value:function(e){var t=this;this.setState({loading:!0}),F.a.get("".concat(M,"/history")).then((function(s){t.setState({loading:!1,historyTasks:s.data.tasks,displayHistory:e}),g.b.info(t.t("load_history_records",{size:s.data.tasks.length}))})).catch((function(e){g.b.error(t.t("service_err",{err:e})),t.setState({loading:!1})}))}},{key:"showHistory",value:function(){0===this.state.historyTasks.length?this.updateHistory(!0):this.setState({displayHistory:!0})}},{key:"poll",value:function(e){var t=this;void 0===e&&(e=this.state.task),void 0!==e&&"Succeed"!==e.status&&"Fail"!==e.status&&(this.poll_process&&clearInterval(this.poll_process),this.poll_process=setInterval((function(){F.a.get("".concat(M,"/get/").concat(e._id)).then((function(e){var s=e.data.task;"Succeed"!==s.status&&"Fail"!==s.status||(clearInterval(t.poll_process),"Succeed"===s.status&&g.b.success(t.t("generation_succeed_all_img",{size:s.num_images}))),s._id===t.state.task._id&&s.status===t.state.task.status||t.setState({task:s})})).catch((function(e){g.b.error(t.t("service_err",{err:e})),clearInterval(t.poll_process)}))}),1e3*this.poll_interval))}},{key:"generate",value:function(e){var t=this;void 0===e&&(e=!1),this.poll_process&&clearInterval(this.poll_process),0===this.state.username.trim().length?(g.b.warning(this.t("input_name_not_empty")),this.setState({task:void 0})):this.state.query.trim().length<2||this.state.query.trim().length>30?(g.b.warning(this.t("input_length_not_valid",{size:this.state.query.trim().length})),this.setState({task:void 0})):Date.now()-this.last_submit_time<5e3?(g.b.warning(this.t("submit_too_fast")),this.setState({task:void 0})):(this.last_submit_time=Date.now(),localStorage.setItem(R,this.state.username),this.setState({loading:!0,task:void 0}),F.a.post("".concat(M,"/generate"),{username:this.state.username,query:this.state.query,force_refresh:e,lang:this.state.lang}).then((function(e){if(!e.data.status)return g.b.info("".concat(t.t("request_failed")).concat(e.data.message)),void t.setState({loading:!1});var s=e.data._id;F.a.get("".concat(M,"/get/").concat(s)).then((function(e){var s=e.data.task;"Succeed"===s.status&&g.b.success(t.t("generation_succeed_all_img",{size:s.num_images})),t.setState({loading:!1,task:s}),t.poll(s)})).catch((function(e){g.b.error(t.t("service_err",{err:e})),t.setState({loading:!1})}))})).catch((function(e){g.b.error(t.t("service_err",{err:e})),t.setState({loading:!1})})))}},{key:"renderTask",value:function(){var e=this.state.task,t=e?e.status:"Not Found";return Object(a.jsxs)("div",{className:"task-display",children:["Not Found"===t&&Object(a.jsx)(p.a,{status:"warning",title:this.t("task_not_found"),subTitle:this.t("plz_regenerate")}),"Fail"===t&&Object(a.jsx)(p.a,{status:"error",title:this.t("generate_fail"),subTitle:this.t("plz_regenerate_or_other")}),"Created"===t&&Object(a.jsx)(p.a,{icon:Object(a.jsx)(z.a,{}),title:this.t("submitted_and_queue"),subTitle:""}),"Running"===t&&Object(a.jsx)(p.a,{icon:Object(a.jsx)(T.a,{}),title:this.t("generating"),subTitle:this.t("generate_and_wait")}),"Succeed"===t&&Object(a.jsx)(v.a,{showIndex:!0,showFullscreenButton:!1,showPlayButton:!1,items:I.a.range(e.num_images).map((function(t){var s="".concat(M,"/get-image/").concat(e.qid,"/").concat(e.created_time,"/").concat(t,".jpg");return{original:s,thumbnail:s,height:96,width:96}}))})]})}},{key:"renderDefaultPlay",value:function(){return Object(a.jsx)("div",{className:"task-display",children:Object(a.jsx)(v.a,{className:"task-image-gallery",showIndex:!0,showFullscreenButton:!1,showPlayButton:!1,items:G.map((function(e){var t="".concat(M).concat(e.original);return Object(o.a)(Object(o.a)({},e),{},{original:t,thumbnail:t})}))})})}},{key:"renderIcon",value:function(e){return"Succeed"===e?Object(a.jsx)(S.a,{style:{color:"#73d13d"}}):"Fail"===e?Object(a.jsx)(N.a,{style:{color:"#ff7a45"}}):"Created"===e?Object(a.jsx)(z.a,{style:{color:"#40a9ff"}}):"Running"===e?Object(a.jsx)(T.a,{style:{color:"#36cfc9"}}):Object(a.jsx)(q.a,{style:{color:"#ffec3d"}})}},{key:"renderHistory",value:function(){var e=this;return Object(a.jsx)(j.a,{title:Object(a.jsx)("div",{className:"history-title",children:Object(a.jsx)("span",{children:this.t("history_records")})}),placement:"right",closable:!0,onClose:function(){return e.setState({displayHistory:!1})},visible:this.state.displayHistory,width:"300px",children:Object(a.jsx)(_.b,{itemLayout:"horizontal",dataSource:this.state.historyTasks,renderItem:function(t){return Object(a.jsx)(_.b.Item,{actions:[],children:Object(a.jsx)(_.b.Item.Meta,{className:"history-item",avatar:e.renderIcon(t.status),title:t.query,description:Object(a.jsxs)("div",{className:"history-description",children:[Object(a.jsx)("p",{children:"".concat(e.t("author_prompt")).concat(t.username)}),Object(a.jsx)("p",{children:"".concat(e.t("create_time_prompt")).concat(e.datestr(t.created_time))}),Object(a.jsx)("p",{children:"".concat(e.t("generate_time_prompt")).concat(e.datestr(parseInt(t.updated_time)))})]}),onClick:function(){e.poll_process&&clearInterval(e.poll_process),e.setState({query:t.query,task:t,displayHistory:!1})}})})}})})}},{key:"componentWillUnmount",value:function(){this.poll_process&&clearInterval(this.poll_process)}},{key:"renderWaitingList",value:function(){var e=this;return Object(a.jsxs)("div",{className:"waiting-list",children:[Object(a.jsxs)(y.a,{children:[this.t("queue_list",{size:this.state.waitingTasks.length>=20?"\u226520":this.state.waitingTasks.length}),this.state.waitingTime>0&&this.t("queue_time",{size:this.state.waitingTime>=15?"\u226515":this.state.waitingTime})]}),Object(a.jsx)("div",{className:"items",children:this.state.waitingTasks.map((function(t,s){return Object(a.jsxs)("div",{className:"item",children:[e.renderIcon(t.status),Object(a.jsxs)("div",{className:"content",children:[Object(a.jsx)("span",{className:"title",children:t.query}),Object(a.jsx)("br",{}),Object(a.jsxs)("span",{className:"time",children:["[",e.datestr(t.created_time),"]"]}),Object(a.jsxs)("span",{className:"author",children:["\uff08",t.username,"\uff09"]})]})]},s)}))})]})}},{key:"render",value:function(){return Object(a.jsxs)("div",{className:"App",style:{backgroundImage:"url(".concat("/CogView","/background.jpg)"),backgroundSize:"cover"},children:[Object(a.jsx)("div",{className:"App-background"}),Object(a.jsxs)("div",{className:"App-inner",children:["login"===this.state.model&&this.renderLogin(),this.state.task&&this.renderTask(),!this.state.task&&this.renderDefaultPlay(),this.renderWaitingList()]}),this.renderHistory(),this.state.loading&&Object(a.jsx)("div",{className:"loading-mask",children:Object(a.jsx)("div",{className:"mask-inner",children:Object(a.jsx)(T.a,{})})})]})}}]),s}(n.Component),V=function(e){e&&e instanceof Function&&s.e(3).then(s.bind(null,202)).then((function(t){var s=t.getCLS,a=t.getFID,n=t.getFCP,i=t.getLCP,r=t.getTTFB;s(e),a(e),n(e),i(e),r(e)}))};c.a.render(Object(a.jsx)(i.a.StrictMode,{children:Object(a.jsx)(W,{})}),document.getElementById("root")),V()}},[[186,1,2]]]);
//# sourceMappingURL=main.3969309e.chunk.js.map